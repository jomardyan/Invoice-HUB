npm warn Unknown cli config "--coverage". This will stop working in the next major version of npm.

> invoice-hub-backend@1.0.0 test
> jest --coverage

ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
FAIL src/__tests__/unit/services/SchedulerService.test.ts (20.401 s)
  ÔŚĆ SchedulerService ÔÇ║ task registration ÔÇ║ should support cron expressions

    expect(received).toMatch(expected)

    Expected pattern: /^\d+ \d+ \d+ \d+ \d+$/
    Received string:  "0 9 * * *"

      20 |
      21 |       cronExpressions.forEach(cron => {
    > 22 |         expect(cron).toMatch(/^\d+ \d+ \d+ \d+ \d+$/);
         |                      ^
      23 |       });
      24 |     });
      25 |   });

      at src/__tests__/unit/services/SchedulerService.test.ts:22:22
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/__tests__/unit/services/SchedulerService.test.ts:21:23)

FAIL src/__tests__/unit/services/TenantService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/TenantService.test.ts:4:7 - error TS6133: 'tenantService' is declared but its value is never read.

    4   let tenantService: TenantService;
            ~~~~~~~~~~~~~
    src/__tests__/unit/services/TenantService.test.ts:178:13 - error TS6133: 'userId' is declared but its value is never read.

    178       const userId = 'user-123';
                    ~~~~~~
    src/__tests__/unit/services/TenantService.test.ts:189:25 - error TS2367: This comparison appears to be unintentional because the types '"tenant-001"' and '"tenant-002"' have no overlap.

    189       const hasAccess = currentTenant === requestTenant;
                                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/TenantService.test.ts:356:13 - error TS6133: 'role' is declared but its value is never read.

    356       const role = 'admin';
                    ~~~~
    src/__tests__/unit/services/TenantService.test.ts:363:13 - error TS6133: 'role' is declared but its value is never read.

    363       const role = 'user';
                    ~~~~
    src/__tests__/unit/services/TenantService.test.ts:370:13 - error TS6133: 'role' is declared but its value is never read.

    370       const role = 'readonly';
                    ~~~~
    src/__tests__/unit/services/TenantService.test.ts:377:13 - error TS6133: 'role' is declared but its value is never read.

    377       const role = 'accounting';
                    ~~~~
    src/__tests__/unit/services/TenantService.test.ts:522:46 - error TS2345: Argument of type 'Date' is not assignable to parameter of type 'number | bigint'.

    522       expect(logs[0].timestamp).toBeLessThan(logs[1].timestamp);
                                                     ~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/TenantService.test.ts:567:13 - error TS6133: 'tenantId' is declared but its value is never read.

    567       const tenantId = 'tenant-001';
                    ~~~~~~~~

FAIL src/__tests__/unit/services/WebhookService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/WebhookService.test.ts:1:10 - error TS2614: Module '"@/services/WebhookService"' has no exported member 'WebhookService'. Did you mean to use 'import WebhookService from "@/services/WebhookService"' instead?

    1 import { WebhookService } from '@/services/WebhookService';
               ~~~~~~~~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:2:10 - error TS6133: 'Webhook' is declared but its value is never read.

    2 import { Webhook, WebhookEvent, WebhookStatus } from '@/entities/Webhook';
               ~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:10:7 - error TS6133: 'webhookService' is declared but its value is never read.

    10   let webhookService: WebhookService;
             ~~~~~~~~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:112:13 - error TS6133: 'payload' is declared but its value is never read.

    112       const payload = 'payload-data';
                    ~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:113:13 - error TS6133: 'secret' is declared but its value is never read.

    113       const secret = 'webhook-secret';
                    ~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:141:32 - error TS2339: Property 'DELIVERED' does not exist on type 'typeof DeliveryStatus'.

    141         status: DeliveryStatus.DELIVERED,
                                       ~~~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:145:51 - error TS2339: Property 'DELIVERED' does not exist on type 'typeof DeliveryStatus'.

    145       expect(delivery.status).toBe(DeliveryStatus.DELIVERED);
                                                          ~~~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:230:28 - error TS2339: Property 'DISABLED' does not exist on type 'typeof WebhookStatus'.

    230       expect(WebhookStatus.DISABLED).toBe('DISABLED');
                                   ~~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:291:32 - error TS2339: Property 'DELIVERED' does not exist on type 'typeof DeliveryStatus'.

    291         status: DeliveryStatus.DELIVERED,
                                       ~~~~~~~~~

FAIL src/__tests__/unit/services/ProductService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/ProductService.test.ts:8:7 - error TS6133: 'productService' is declared but its value is never read.

    8   let productService: ProductService;
            ~~~~~~~~~~~~~~
    src/__tests__/unit/services/ProductService.test.ts:148:14 - error TS18048: 'input.description' is possibly 'undefined'.

    148       expect(input.description.length).toBeGreaterThan(0);
                     ~~~~~~~~~~~~~~~~~

FAIL src/__tests__/unit/services/ReportingService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/ReportingService.test.ts:1:10 - error TS2614: Module '"@/services/ReportingService"' has no exported member 'ReportingService'. Did you mean to use 'import ReportingService from "@/services/ReportingService"' instead?

    1 import { ReportingService, SalesReport, TaxReport, CustomerAnalytics, DashboardMetrics } from '@/services/ReportingService';
               ~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/ReportingService.test.ts:9:7 - error TS6133: 'reportingService' is declared but its value is never read.

    9   let reportingService: ReportingService;
            ~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/ReportingService.test.ts:82:33 - error TS2551: Property 'UNPAID' does not exist on type 'typeof InvoiceStatus'. Did you mean 'PAID'?

    82         { status: InvoiceStatus.UNPAID, count: 12, totalAmount: 6000 },
                                       ~~~~~~

      src/entities/Invoice.ts:31:3
        31   PAID = 'paid',
             ~~~~
        'PAID' is declared here.
    src/__tests__/unit/services/ReportingService.test.ts:208:11 - error TS2353: Object literal may only specify known properties, and 'date' does not exist in type '{ date: Date; type: string; description: string; }[]'.

    208           date: new Date(),
                  ~~~~

      src/services/ReportingService.ts:99:3
        99   recentActivity: {
             ~~~~~~~~~~~~~~
        The expected type comes from property 'recentActivity' which is declared here on type 'DashboardMetrics'
    src/__tests__/unit/services/ReportingService.test.ts:257:13 - error TS6133: 'year' is declared but its value is never read.

    257       const year = 2024;
                    ~~~~
    src/__tests__/unit/services/ReportingService.test.ts:264:13 - error TS6133: 'year' is declared but its value is never read.

    264       const year = 2024;
                    ~~~~

FAIL src/__tests__/unit/services/NotificationService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/NotificationService.test.ts:1:10 - error TS2614: Module '"@/services/NotificationService"' has no exported member 'NotificationService'. Did you mean to use 'import NotificationService from "@/services/NotificationService"' instead?

    1 import { NotificationService, NotificationType, NotificationChannel, NotificationPriority, CreateNotificationInput } from '@/services/NotificationService';
               ~~~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/NotificationService.test.ts:8:7 - error TS6133: 'notificationService' is declared but its value is never read.

    8   let notificationService: NotificationService;
            ~~~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/NotificationService.test.ts:216:7 - error TS2322: Type 'Date' is not assignable to type 'undefined'.

    216       notification.readAt = new Date();
              ~~~~~~~~~~~~~~~~~~~

FAIL src/__tests__/setup.ts
  ÔŚĆ Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/__tests__/unit/services/CustomerService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/CustomerService.test.ts:9:7 - error TS6133: 'customerService' is declared but its value is never read.

    9   let customerService: CustomerService;
            ~~~~~~~~~~~~~~~
    src/__tests__/unit/services/CustomerService.test.ts:48:28 - error TS2345: Argument of type 'string | undefined' is not assignable to parameter of type 'string'.
      Type 'undefined' is not assignable to type 'string'.

    48       expect(nipRegex.test(businessCustomer.nip)).toBe(true);
                                  ~~~~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/CustomerService.test.ts:195:14 - error TS18048: 'input.notes' is possibly 'undefined'.

    195       expect(input.notes.length).toBeGreaterThan(0);
                     ~~~~~~~~~~~

FAIL src/__tests__/unit/services/EmailService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/EmailService.test.ts:4:7 - error TS6133: 'emailService' is declared but its value is never read.

    4   let emailService: EmailService;
            ~~~~~~~~~~~~
    src/__tests__/unit/services/EmailService.test.ts:393:13 - error TS6133: 'offset' is declared but its value is never read.

    393       const offset = 60; // Warsaw is UTC+1 or UTC+2 depending on DST
                    ~~~~~~

FAIL src/__tests__/unit/services/ExportService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/ExportService.test.ts:1:10 - error TS2614: Module '"@/services/ExportService"' has no exported member 'ExportService'. Did you mean to use 'import ExportService from "@/services/ExportService"' instead?

    1 import { ExportService, ExportFormat, ExportOptions, ExportResult } from '@/services/ExportService';
               ~~~~~~~~~~~~~
    src/__tests__/unit/services/ExportService.test.ts:4:7 - error TS6133: 'exportService' is declared but its value is never read.

    4   let exportService: ExportService;
            ~~~~~~~~~~~~~

FAIL src/__tests__/unit/services/MonitoringService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/MonitoringService.test.ts:4:7 - error TS6133: 'monitoringService' is declared but its value is never read.

    4   let monitoringService: MonitoringService;
            ~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/MonitoringService.test.ts:7:25 - error TS2673: Constructor of class 'MonitoringService' is private and only accessible within the class declaration.

    7     monitoringService = new MonitoringService();
                              ~~~~~~~~~~~~~~~~~~~~~~~

FAIL src/__tests__/unit/services/TaxCalculationService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/TaxCalculationService.test.ts:4:7 - error TS6133: 'taxService' is declared but its value is never read.

    4   let taxService: TaxCalculationService;
            ~~~~~~~~~~

FAIL src/__tests__/unit/services/PaymentService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/PaymentService.test.ts:1:10 - error TS2614: Module '"@/services/PaymentService"' has no exported member 'PaymentService'. Did you mean to use 'import PaymentService from "@/services/PaymentService"' instead?

    1 import { PaymentService, CreatePaymentInput, PaymentRefund } from '@/services/PaymentService';
               ~~~~~~~~~~~~~~
    src/__tests__/unit/services/PaymentService.test.ts:1:26 - error TS2614: Module '"@/services/PaymentService"' has no exported member 'CreatePaymentInput'. Did you mean to use 'import CreatePaymentInput from "@/services/PaymentService"' instead?

    1 import { PaymentService, CreatePaymentInput, PaymentRefund } from '@/services/PaymentService';
                               ~~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/PaymentService.test.ts:1:46 - error TS2614: Module '"@/services/PaymentService"' has no exported member 'PaymentRefund'. Did you mean to use 'import PaymentRefund from "@/services/PaymentService"' instead?

    1 import { PaymentService, CreatePaymentInput, PaymentRefund } from '@/services/PaymentService';
                                                   ~~~~~~~~~~~~~
    src/__tests__/unit/services/PaymentService.test.ts:11:7 - error TS6133: 'paymentService' is declared but its value is never read.

    11   let paymentService: PaymentService;
             ~~~~~~~~~~~~~~
    src/__tests__/unit/services/PaymentService.test.ts:27:30 - error TS2339: Property 'MANUAL' does not exist on type 'typeof PaymentProvider'.

    27       expect(PaymentProvider.MANUAL).toBe('manual');
                                    ~~~~~~

FAIL src/__tests__/unit/services/TemplateService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/TemplateService.test.ts:8:7 - error TS6133: 'templateService' is declared but its value is never read.

    8   let templateService: TemplateService;
            ~~~~~~~~~~~~~~~

FAIL src/__tests__/unit/services/SMSService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/SMSService.test.ts:1:10 - error TS2614: Module '"@/services/SMSService"' has no exported member 'SMSService'. Did you mean to use 'import SMSService from "@/services/SMSService"' instead?

    1 import { SMSService } from '@/services/SMSService';
               ~~~~~~~~~~
    src/__tests__/unit/services/SMSService.test.ts:4:7 - error TS6133: 'smsService' is declared but its value is never read.

    4   let smsService: SMSService;
            ~~~~~~~~~~

FAIL src/__tests__/unit/services/CompanyService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/CompanyService.test.ts:2:1 - error TS6133: 'Company' is declared but its value is never read.

    2 import { Company } from '@/entities/Company';
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/CompanyService.test.ts:9:7 - error TS6133: 'companyService' is declared but its value is never read.

    9   let companyService: CompanyService;
            ~~~~~~~~~~~~~~

PASS src/__tests__/mocks/database.mock.ts
FAIL src/__tests__/integration/api.integration.test.ts
  ÔŚĆ Test suite failed to run

    ReferenceError: TextEncoder is not defined

    > 1 | import request from 'supertest';
        | ^
      2 | import express from 'express';
      3 |
      4 | // Mock Express app for testing

      at utf8ToBytes (node_modules/@noble/hashes/src/utils.ts:217:29)
      at toBytes (node_modules/@noble/hashes/src/utils.ts:236:40)
      at hashC (node_modules/@noble/hashes/src/utils.ts:342:63)
      at hash (node_modules/@paralleldrive/cuid2/src/index.js:34:22)
      at createFingerprint (node_modules/@paralleldrive/cuid2/src/index.js:63:10)
      at init (node_modules/@paralleldrive/cuid2/src/index.js:81:17)
      at Object.<anonymous> (node_modules/@paralleldrive/cuid2/src/index.js:101:18)
      at Object.<anonymous> (node_modules/@paralleldrive/cuid2/index.js:1:50)
      at Object.<anonymous> (node_modules/formidable/dist/index.cjs:8:13)
      at Object.require (node_modules/superagent/src/node/index.js:16:20)
      at Object.<anonymous> (node_modules/supertest/lib/test.js:12:21)
      at Object.<anonymous> (node_modules/supertest/index.js:13:14)
      at Object.<anonymous> (src/__tests__/integration/api.integration.test.ts:1:1)

PASS src/__tests__/unit/services/AuthService.test.ts (26.51 s)
PASS src/__tests__/unit/services/InvoiceService.test.ts (26.419 s)
FAIL src/__tests__/unit/services/AllegroService.test.ts
  ÔŚĆ Test suite failed to run

    DriverPackageNotInstalledError: Postgres package has not been found installed. Please run "npm install pg".

      at PostgresDriver.loadDependencies (src/driver/postgres/PostgresDriver.ts:1492:19)
      at new PostgresDriver (src/driver/postgres/PostgresDriver.ts:321:14)
      at DriverFactory.create (src/driver/DriverFactory.ts:36:24)
      at new DataSource (src/data-source/DataSource.ts:150:43)
      at Object.<anonymous> (src/config/database.ts:4:30)
      at Object.require (src/services/AllegroService.ts:3:1)
      at Object.<anonymous> (src/__tests__/unit/services/AllegroService.test.ts:2:1)

---------------------------|---------|----------|---------|---------|-------------------
File                       | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
---------------------------|---------|----------|---------|---------|-------------------
All files                  |    6.48 |      0.8 |    1.14 |    6.38 |                   
 src                       |       0 |        0 |       0 |       0 |                   
  app.ts                   |       0 |        0 |       0 |       0 | 1-206             
 src/config                |       0 |        0 |       0 |       0 |                   
  database.ts              |       0 |      100 |     100 |       0 | 1-4               
  index.ts                 |       0 |        0 |     100 |       0 | 1-173             
  redis.ts                 |       0 |        0 |       0 |       0 | 1-74              
  swagger.ts               |       0 |      100 |     100 |       0 | 5-264             
 src/entities              |   65.27 |    54.54 |   11.11 |   68.03 |                   
  AllegroIntegration.ts    |      88 |      100 |       0 |    90.9 | 23,30             
  Company.ts               |    87.5 |      100 |       0 |   92.85 | 24,82             
  Customer.ts              |    92.5 |      100 |      25 |   94.59 | 30,109            
  Invoice.ts               |   85.71 |      100 |   16.66 |   92.06 | 50,57,64,71,155   
  InvoiceItem.ts           |   85.71 |      100 |       0 |   91.66 | 21,28             
  Payment.ts               |       0 |        0 |       0 |       0 | 5-103             
  Product.ts               |   89.65 |      100 |       0 |    92.3 | 25,71             
  Tenant.ts                |   84.61 |      100 |      25 |   91.17 | 76,79,82          
  User.ts                  |   85.36 |      100 |   14.28 |   91.66 | 33,89,92          
  Webhook.ts               |       0 |        0 |       0 |       0 | 5-88              
  WebhookDelivery.ts       |       0 |        0 |       0 |       0 | 5-68              
 src/middleware            |       0 |        0 |       0 |       0 |                   
  auth.ts                  |       0 |        0 |       0 |       0 | 3-100             
  errorHandler.ts          |       0 |        0 |       0 |       0 | 2-46              
  monitoring.ts            |       0 |        0 |       0 |       0 | 2-228             
  rateLimiter.ts           |       0 |      100 |     100 |       0 | 1-12              
 src/routes                |       0 |        0 |       0 |       0 |                   
  allegro.ts               |       0 |        0 |       0 |       0 | 1-173             
  auth.ts                  |       0 |        0 |       0 |       0 | 1-175             
  companies.ts             |       0 |        0 |       0 |       0 | 1-181             
  customers.ts             |       0 |        0 |       0 |       0 | 1-275             
  health.ts                |       0 |        0 |       0 |       0 | 1-167             
  invoices.ts              |       0 |        0 |       0 |       0 | 1-516             
  notifications.ts         |       0 |        0 |       0 |       0 | 6-204             
  payments.ts              |       0 |        0 |       0 |       0 | 5-217             
  products.ts              |       0 |        0 |       0 |       0 | 1-244             
  reports.ts               |       0 |        0 |       0 |       0 | 5-299             
  scheduler.ts             |       0 |        0 |       0 |       0 | 6-124             
  templates.ts             |       0 |        0 |       0 |       0 | 1-109             
  webhooks.ts              |       0 |        0 |       0 |       0 | 5-200             
 src/services              |       0 |        0 |       0 |       0 |                   
  AllegroService.ts        |       0 |        0 |       0 |       0 | 1-587             
  AuthService.ts           |       0 |        0 |       0 |       0 | 1-243             
  CompanyService.ts        |       0 |        0 |       0 |       0 | 1-181             
  CustomerService.ts       |       0 |        0 |       0 |       0 | 1-269             
  EmailService.ts          |       0 |        0 |       0 |       0 | 1-438             
  ExportService.ts         |       0 |        0 |       0 |       0 | 6-794             
  InvoiceService.ts        |       0 |        0 |       0 |       0 | 2-801             
  MonitoringService.ts     |       0 |        0 |       0 |       0 | 1-387             
  NotificationService.ts   |       0 |        0 |       0 |       0 | 7-502             
  PaymentService.ts        |       0 |        0 |       0 |       0 | 6-509             
  ProductService.ts        |       0 |        0 |       0 |       0 | 1-193             
  ReportingService.ts      |       0 |        0 |       0 |       0 | 7-532             
  SMSService.ts            |       0 |        0 |       0 |       0 | 6-305             
  SchedulerService.ts      |       0 |        0 |       0 |       0 | 6-314             
  TaxCalculationService.ts |       0 |        0 |       0 |       0 | 1-342             
  TemplateService.ts       |       0 |        0 |       0 |       0 | 1-644             
  TenantService.ts         |       0 |        0 |       0 |       0 | 1-195             
  WebhookService.ts        |       0 |        0 |       0 |       0 | 6-376             
 src/utils                 |       0 |        0 |       0 |       0 |                   
  encryption.ts            |       0 |      100 |       0 |       0 | 1-50              
  jwt.ts                   |       0 |      100 |       0 |       0 | 1-55              
  logger.ts                |       0 |        0 |       0 |       0 | 1-138             
  password.ts              |       0 |        0 |       0 |       0 | 1-29              
---------------------------|---------|----------|---------|---------|-------------------
Jest: "global" coverage threshold for statements (40%) not met: 6.48%
Jest: "global" coverage threshold for branches (40%) not met: 0.8%
Jest: "global" coverage threshold for lines (40%) not met: 6.38%
Jest: "global" coverage threshold for functions (40%) not met: 1.14%
Summary of all failing tests
FAIL src/__tests__/unit/services/SchedulerService.test.ts (20.401 s)
  ÔŚĆ SchedulerService ÔÇ║ task registration ÔÇ║ should support cron expressions

    expect(received).toMatch(expected)

    Expected pattern: /^\d+ \d+ \d+ \d+ \d+$/
    Received string:  "0 9 * * *"

      20 |
      21 |       cronExpressions.forEach(cron => {
    > 22 |         expect(cron).toMatch(/^\d+ \d+ \d+ \d+ \d+$/);
         |                      ^
      23 |       });
      24 |     });
      25 |   });

      at src/__tests__/unit/services/SchedulerService.test.ts:22:22
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/__tests__/unit/services/SchedulerService.test.ts:21:23)

FAIL src/__tests__/unit/services/TenantService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/TenantService.test.ts:4:7 - error TS6133: 'tenantService' is declared but its value is never read.

    4   let tenantService: TenantService;
            ~~~~~~~~~~~~~
    src/__tests__/unit/services/TenantService.test.ts:178:13 - error TS6133: 'userId' is declared but its value is never read.

    178       const userId = 'user-123';
                    ~~~~~~
    src/__tests__/unit/services/TenantService.test.ts:189:25 - error TS2367: This comparison appears to be unintentional because the types '"tenant-001"' and '"tenant-002"' have no overlap.

    189       const hasAccess = currentTenant === requestTenant;
                                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/TenantService.test.ts:356:13 - error TS6133: 'role' is declared but its value is never read.

    356       const role = 'admin';
                    ~~~~
    src/__tests__/unit/services/TenantService.test.ts:363:13 - error TS6133: 'role' is declared but its value is never read.

    363       const role = 'user';
                    ~~~~
    src/__tests__/unit/services/TenantService.test.ts:370:13 - error TS6133: 'role' is declared but its value is never read.

    370       const role = 'readonly';
                    ~~~~
    src/__tests__/unit/services/TenantService.test.ts:377:13 - error TS6133: 'role' is declared but its value is never read.

    377       const role = 'accounting';
                    ~~~~
    src/__tests__/unit/services/TenantService.test.ts:522:46 - error TS2345: Argument of type 'Date' is not assignable to parameter of type 'number | bigint'.

    522       expect(logs[0].timestamp).toBeLessThan(logs[1].timestamp);
                                                     ~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/TenantService.test.ts:567:13 - error TS6133: 'tenantId' is declared but its value is never read.

    567       const tenantId = 'tenant-001';
                    ~~~~~~~~

FAIL src/__tests__/unit/services/WebhookService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/WebhookService.test.ts:1:10 - error TS2614: Module '"@/services/WebhookService"' has no exported member 'WebhookService'. Did you mean to use 'import WebhookService from "@/services/WebhookService"' instead?

    1 import { WebhookService } from '@/services/WebhookService';
               ~~~~~~~~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:2:10 - error TS6133: 'Webhook' is declared but its value is never read.

    2 import { Webhook, WebhookEvent, WebhookStatus } from '@/entities/Webhook';
               ~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:10:7 - error TS6133: 'webhookService' is declared but its value is never read.

    10   let webhookService: WebhookService;
             ~~~~~~~~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:112:13 - error TS6133: 'payload' is declared but its value is never read.

    112       const payload = 'payload-data';
                    ~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:113:13 - error TS6133: 'secret' is declared but its value is never read.

    113       const secret = 'webhook-secret';
                    ~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:141:32 - error TS2339: Property 'DELIVERED' does not exist on type 'typeof DeliveryStatus'.

    141         status: DeliveryStatus.DELIVERED,
                                       ~~~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:145:51 - error TS2339: Property 'DELIVERED' does not exist on type 'typeof DeliveryStatus'.

    145       expect(delivery.status).toBe(DeliveryStatus.DELIVERED);
                                                          ~~~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:230:28 - error TS2339: Property 'DISABLED' does not exist on type 'typeof WebhookStatus'.

    230       expect(WebhookStatus.DISABLED).toBe('DISABLED');
                                   ~~~~~~~~
    src/__tests__/unit/services/WebhookService.test.ts:291:32 - error TS2339: Property 'DELIVERED' does not exist on type 'typeof DeliveryStatus'.

    291         status: DeliveryStatus.DELIVERED,
                                       ~~~~~~~~~

FAIL src/__tests__/unit/services/ProductService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/ProductService.test.ts:8:7 - error TS6133: 'productService' is declared but its value is never read.

    8   let productService: ProductService;
            ~~~~~~~~~~~~~~
    src/__tests__/unit/services/ProductService.test.ts:148:14 - error TS18048: 'input.description' is possibly 'undefined'.

    148       expect(input.description.length).toBeGreaterThan(0);
                     ~~~~~~~~~~~~~~~~~

FAIL src/__tests__/unit/services/ReportingService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/ReportingService.test.ts:1:10 - error TS2614: Module '"@/services/ReportingService"' has no exported member 'ReportingService'. Did you mean to use 'import ReportingService from "@/services/ReportingService"' instead?

    1 import { ReportingService, SalesReport, TaxReport, CustomerAnalytics, DashboardMetrics } from '@/services/ReportingService';
               ~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/ReportingService.test.ts:9:7 - error TS6133: 'reportingService' is declared but its value is never read.

    9   let reportingService: ReportingService;
            ~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/ReportingService.test.ts:82:33 - error TS2551: Property 'UNPAID' does not exist on type 'typeof InvoiceStatus'. Did you mean 'PAID'?

    82         { status: InvoiceStatus.UNPAID, count: 12, totalAmount: 6000 },
                                       ~~~~~~

      src/entities/Invoice.ts:31:3
        31   PAID = 'paid',
             ~~~~
        'PAID' is declared here.
    src/__tests__/unit/services/ReportingService.test.ts:208:11 - error TS2353: Object literal may only specify known properties, and 'date' does not exist in type '{ date: Date; type: string; description: string; }[]'.

    208           date: new Date(),
                  ~~~~

      src/services/ReportingService.ts:99:3
        99   recentActivity: {
             ~~~~~~~~~~~~~~
        The expected type comes from property 'recentActivity' which is declared here on type 'DashboardMetrics'
    src/__tests__/unit/services/ReportingService.test.ts:257:13 - error TS6133: 'year' is declared but its value is never read.

    257       const year = 2024;
                    ~~~~
    src/__tests__/unit/services/ReportingService.test.ts:264:13 - error TS6133: 'year' is declared but its value is never read.

    264       const year = 2024;
                    ~~~~

FAIL src/__tests__/unit/services/NotificationService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/NotificationService.test.ts:1:10 - error TS2614: Module '"@/services/NotificationService"' has no exported member 'NotificationService'. Did you mean to use 'import NotificationService from "@/services/NotificationService"' instead?

    1 import { NotificationService, NotificationType, NotificationChannel, NotificationPriority, CreateNotificationInput } from '@/services/NotificationService';
               ~~~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/NotificationService.test.ts:8:7 - error TS6133: 'notificationService' is declared but its value is never read.

    8   let notificationService: NotificationService;
            ~~~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/NotificationService.test.ts:216:7 - error TS2322: Type 'Date' is not assignable to type 'undefined'.

    216       notification.readAt = new Date();
              ~~~~~~~~~~~~~~~~~~~

FAIL src/__tests__/setup.ts
  ÔŚĆ Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/__tests__/unit/services/CustomerService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/CustomerService.test.ts:9:7 - error TS6133: 'customerService' is declared but its value is never read.

    9   let customerService: CustomerService;
            ~~~~~~~~~~~~~~~
    src/__tests__/unit/services/CustomerService.test.ts:48:28 - error TS2345: Argument of type 'string | undefined' is not assignable to parameter of type 'string'.
      Type 'undefined' is not assignable to type 'string'.

    48       expect(nipRegex.test(businessCustomer.nip)).toBe(true);
                                  ~~~~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/CustomerService.test.ts:195:14 - error TS18048: 'input.notes' is possibly 'undefined'.

    195       expect(input.notes.length).toBeGreaterThan(0);
                     ~~~~~~~~~~~

FAIL src/__tests__/unit/services/EmailService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/EmailService.test.ts:4:7 - error TS6133: 'emailService' is declared but its value is never read.

    4   let emailService: EmailService;
            ~~~~~~~~~~~~
    src/__tests__/unit/services/EmailService.test.ts:393:13 - error TS6133: 'offset' is declared but its value is never read.

    393       const offset = 60; // Warsaw is UTC+1 or UTC+2 depending on DST
                    ~~~~~~

FAIL src/__tests__/unit/services/ExportService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/ExportService.test.ts:1:10 - error TS2614: Module '"@/services/ExportService"' has no exported member 'ExportService'. Did you mean to use 'import ExportService from "@/services/ExportService"' instead?

    1 import { ExportService, ExportFormat, ExportOptions, ExportResult } from '@/services/ExportService';
               ~~~~~~~~~~~~~
    src/__tests__/unit/services/ExportService.test.ts:4:7 - error TS6133: 'exportService' is declared but its value is never read.

    4   let exportService: ExportService;
            ~~~~~~~~~~~~~

FAIL src/__tests__/unit/services/MonitoringService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/MonitoringService.test.ts:4:7 - error TS6133: 'monitoringService' is declared but its value is never read.

    4   let monitoringService: MonitoringService;
            ~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/MonitoringService.test.ts:7:25 - error TS2673: Constructor of class 'MonitoringService' is private and only accessible within the class declaration.

    7     monitoringService = new MonitoringService();
                              ~~~~~~~~~~~~~~~~~~~~~~~

FAIL src/__tests__/unit/services/TaxCalculationService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/TaxCalculationService.test.ts:4:7 - error TS6133: 'taxService' is declared but its value is never read.

    4   let taxService: TaxCalculationService;
            ~~~~~~~~~~

FAIL src/__tests__/unit/services/PaymentService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/PaymentService.test.ts:1:10 - error TS2614: Module '"@/services/PaymentService"' has no exported member 'PaymentService'. Did you mean to use 'import PaymentService from "@/services/PaymentService"' instead?

    1 import { PaymentService, CreatePaymentInput, PaymentRefund } from '@/services/PaymentService';
               ~~~~~~~~~~~~~~
    src/__tests__/unit/services/PaymentService.test.ts:1:26 - error TS2614: Module '"@/services/PaymentService"' has no exported member 'CreatePaymentInput'. Did you mean to use 'import CreatePaymentInput from "@/services/PaymentService"' instead?

    1 import { PaymentService, CreatePaymentInput, PaymentRefund } from '@/services/PaymentService';
                               ~~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/PaymentService.test.ts:1:46 - error TS2614: Module '"@/services/PaymentService"' has no exported member 'PaymentRefund'. Did you mean to use 'import PaymentRefund from "@/services/PaymentService"' instead?

    1 import { PaymentService, CreatePaymentInput, PaymentRefund } from '@/services/PaymentService';
                                                   ~~~~~~~~~~~~~
    src/__tests__/unit/services/PaymentService.test.ts:11:7 - error TS6133: 'paymentService' is declared but its value is never read.

    11   let paymentService: PaymentService;
             ~~~~~~~~~~~~~~
    src/__tests__/unit/services/PaymentService.test.ts:27:30 - error TS2339: Property 'MANUAL' does not exist on type 'typeof PaymentProvider'.

    27       expect(PaymentProvider.MANUAL).toBe('manual');
                                    ~~~~~~

FAIL src/__tests__/unit/services/TemplateService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/TemplateService.test.ts:8:7 - error TS6133: 'templateService' is declared but its value is never read.

    8   let templateService: TemplateService;
            ~~~~~~~~~~~~~~~

FAIL src/__tests__/unit/services/SMSService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/SMSService.test.ts:1:10 - error TS2614: Module '"@/services/SMSService"' has no exported member 'SMSService'. Did you mean to use 'import SMSService from "@/services/SMSService"' instead?

    1 import { SMSService } from '@/services/SMSService';
               ~~~~~~~~~~
    src/__tests__/unit/services/SMSService.test.ts:4:7 - error TS6133: 'smsService' is declared but its value is never read.

    4   let smsService: SMSService;
            ~~~~~~~~~~

FAIL src/__tests__/unit/services/CompanyService.test.ts
  ÔŚĆ Test suite failed to run

    src/__tests__/unit/services/CompanyService.test.ts:2:1 - error TS6133: 'Company' is declared but its value is never read.

    2 import { Company } from '@/entities/Company';
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    src/__tests__/unit/services/CompanyService.test.ts:9:7 - error TS6133: 'companyService' is declared but its value is never read.

    9   let companyService: CompanyService;
            ~~~~~~~~~~~~~~

FAIL src/__tests__/integration/api.integration.test.ts
  ÔŚĆ Test suite failed to run

    ReferenceError: TextEncoder is not defined

    > 1 | import request from 'supertest';
        | ^
      2 | import express from 'express';
      3 |
      4 | // Mock Express app for testing

      at utf8ToBytes (node_modules/@noble/hashes/src/utils.ts:217:29)
      at toBytes (node_modules/@noble/hashes/src/utils.ts:236:40)
      at hashC (node_modules/@noble/hashes/src/utils.ts:342:63)
      at hash (node_modules/@paralleldrive/cuid2/src/index.js:34:22)
      at createFingerprint (node_modules/@paralleldrive/cuid2/src/index.js:63:10)
      at init (node_modules/@paralleldrive/cuid2/src/index.js:81:17)
      at Object.<anonymous> (node_modules/@paralleldrive/cuid2/src/index.js:101:18)
      at Object.<anonymous> (node_modules/@paralleldrive/cuid2/index.js:1:50)
      at Object.<anonymous> (node_modules/formidable/dist/index.cjs:8:13)
      at Object.require (node_modules/superagent/src/node/index.js:16:20)
      at Object.<anonymous> (node_modules/supertest/lib/test.js:12:21)
      at Object.<anonymous> (node_modules/supertest/index.js:13:14)
      at Object.<anonymous> (src/__tests__/integration/api.integration.test.ts:1:1)

FAIL src/__tests__/unit/services/AllegroService.test.ts
  ÔŚĆ Test suite failed to run

    DriverPackageNotInstalledError: Postgres package has not been found installed. Please run "npm install pg".

      at PostgresDriver.loadDependencies (src/driver/postgres/PostgresDriver.ts:1492:19)
      at new PostgresDriver (src/driver/postgres/PostgresDriver.ts:321:14)
      at DriverFactory.create (src/driver/DriverFactory.ts:36:24)
      at new DataSource (src/data-source/DataSource.ts:150:43)
      at Object.<anonymous> (src/config/database.ts:4:30)
      at Object.require (src/services/AllegroService.ts:3:1)
      at Object.<anonymous> (src/__tests__/unit/services/AllegroService.test.ts:2:1)


Test Suites: 18 failed, 3 passed, 21 total
Tests:       1 failed, 61 passed, 62 total
Snapshots:   0 total
Time:        64.506 s
Ran all test suites.
